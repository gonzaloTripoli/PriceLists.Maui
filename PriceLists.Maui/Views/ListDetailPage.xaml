<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:models="clr-namespace:PriceLists.Core.Models;assembly=PriceLists.Core"
             xmlns:vm="clr-namespace:PriceLists.Maui.ViewModels"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes"
             x:Class="PriceLists.Maui.Views.ListDetailPage"
             x:DataType="vm:ListDetailViewModel"
             Title="{Binding ListName}">
    <ContentPage.Resources>
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="StrokeThickness" Value="1" />
            <Setter Property="Stroke" Value="{AppThemeBinding Light='#E5E7EB', Dark='#2F2F2F'}" />
            <Setter Property="Background" Value="{AppThemeBinding Light='#FFFFFF', Dark='#161616'}" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <shapes:RoundRectangle CornerRadius="16" />
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="CaptionLabel" TargetType="Label">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light='#6B7280', Dark='#9CA3AF'}" />
        </Style>
        <Style x:Key="BadgeBorderStyle" TargetType="Border">
            <Setter Property="StrokeThickness" Value="0" />
            <Setter Property="Background" Value="{AppThemeBinding Light='#EEF2FF', Dark='#1E1B4B'}" />
            <Setter Property="Padding" Value="8,4" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <shapes:RoundRectangle CornerRadius="12" />
                </Setter.Value>
            </Setter>
        </Style>
    </ContentPage.Resources>

    <ContentPage.Content>
        <Grid RowDefinitions="Auto,*" Padding="20" ColumnSpacing="0">
            <VerticalStackLayout Spacing="12">
                <Label Text="{Binding ListName}"
                       FontAttributes="Bold"
                       FontSize="26"
                       HorizontalTextAlignment="Start" />

                <HorizontalStackLayout Spacing="12" VerticalOptions="Center">
                    <Label Text="{Binding FilteredItemsCount, StringFormat='{}{0} productos'}"
                           FontAttributes="Bold"
                           FontSize="14" />
                    <Border Style="{StaticResource BadgeBorderStyle}"
                            IsVisible="{Binding SectionLabel, Converter={StaticResource StringNotEmptyConverter}}">
                        <HorizontalStackLayout Spacing="6">
                            <BoxView WidthRequest="6"
                                     HeightRequest="6"
                                     VerticalOptions="Center"
                                     BackgroundColor="{AppThemeBinding Light='#6366F1', Dark='#A5B4FC'}"
                                     CornerRadius="3" />
                            <Label Text="{Binding SectionLabel}"
                                   Style="{StaticResource CaptionLabel}" />
                        </HorizontalStackLayout>
                    </Border>
                </HorizontalStackLayout>

                <SearchBar Placeholder="Buscar por cÃ³digo o descripciÃ³n"
                           Text="{Binding SearchText}"
                           CancelButtonColor="{AppThemeBinding Light='#6366F1', Dark='#A5B4FC'}" />

                <Border Background="{AppThemeBinding Light='#F4F4F5', Dark='#1F2937'}"
                        Padding="12"
                        StrokeThickness="0"
                        IsVisible="{Binding StatusMessage, Converter={StaticResource StringNotEmptyConverter}}">
                    <Label Text="{Binding StatusMessage}"
                           TextColor="{AppThemeBinding Light='#6B7280', Dark='#D1D5DB'}" />
                </Border>
            </VerticalStackLayout>

            <Grid Grid.Row="1">
                <CollectionView ItemsSource="{Binding Items}"
                                SelectionMode="None"
                                ItemsLayout="VerticalList"
                                Margin="0,12,0,0">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout Spacing="8"
                                             Padding="24"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             IsVisible="{Binding IsEmpty}">
                            <Label Text="ðŸ—’ï¸" FontSize="36" HorizontalTextAlignment="Center" />
                            <Label Text="No encontramos productos con ese filtro."
                                   HorizontalTextAlignment="Center"
                                   Style="{StaticResource CaptionLabel}" />
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PriceItem">
                            <Border Style="{StaticResource CardBorderStyle}"
                                    Padding="16"
                                    Margin="0,6">
                                <Grid ColumnDefinitions="*,Auto"
                                      RowDefinitions="Auto,Auto,Auto"
                                      ColumnSpacing="12"
                                      RowSpacing="6">
                                    <Border Style="{StaticResource BadgeBorderStyle}"
                                            Grid.Row="0"
                                            Grid.Column="0"
                                            VerticalOptions="Start">
                                        <Label Text="{Binding Code, TargetNullValue='Sin cÃ³digo'}"
                                               FontAttributes="Bold"
                                               FontSize="13"
                                               TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
                                    </Border>

                                    <Label Grid.Row="1"
                                           Grid.Column="0"
                                           Text="{Binding Description}"
                                           FontAttributes="Bold"
                                           FontSize="17"
                                           LineBreakMode="TailTruncation"
                                           MaxLines="2" />

                                    <HorizontalStackLayout Grid.Row="2"
                                                           Grid.Column="0"
                                                           Spacing="6"
                                                           IsVisible="{Binding SectionName, Converter={StaticResource StringNotEmptyConverter}}">
                                        <BoxView WidthRequest="6"
                                                 HeightRequest="6"
                                                 VerticalOptions="Center"
                                                 BackgroundColor="{AppThemeBinding Light='#A855F7', Dark='#C084FC'}"
                                                 CornerRadius="3" />
                                        <Label Text="{Binding SectionName}"
                                               Style="{StaticResource CaptionLabel}" />
                                    </HorizontalStackLayout>

                                    <VerticalStackLayout Grid.Row="0"
                                                         Grid.Column="1"
                                                         Grid.RowSpan="3"
                                                         Spacing="4"
                                                         HorizontalOptions="End"
                                                         VerticalOptions="Center">
                                        <Label Text="{Binding UnitPrice, Converter={StaticResource DecimalToCurrencyConverter}}"
                                               FontAttributes="Bold"
                                               FontSize="20"
                                               HorizontalTextAlignment="End" />
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <ActivityIndicator IsRunning="{Binding IsBusy}"
                                   IsVisible="{Binding IsBusy}"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center"
                                   WidthRequest="48"
                                   HeightRequest="48" />
            </Grid>
        </Grid>
    </ContentPage.Content>
</ContentPage>
