<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PriceLists.Maui.ViewModels"
             xmlns:models="clr-namespace:PriceLists.Core.Models;assembly=PriceLists.Core"
             xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes"
             x:Class="PriceLists.Maui.Views.ListsPage"
             x:DataType="vm:ListsViewModel"
             Title="Listas de precios">
    <ContentPage.Resources>
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="StrokeThickness" Value="1" />
            <Setter Property="Stroke" Value="{AppThemeBinding Light='#E5E7EB', Dark='#2F2F2F'}" />
            <Setter Property="Background" Value="{AppThemeBinding Light='#FFFFFF', Dark='#161616'}" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <shapes:RoundRectangle CornerRadius="18" />
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="MutedLabel" TargetType="Label">
            <Setter Property="FontSize" Value="12" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light='#6B7280', Dark='#9CA3AF'}" />
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="24">
        <VerticalStackLayout Spacing="12">
            <Label Text="Listas de precios"
                   FontAttributes="Bold"
                   FontSize="28"
                   SemanticProperties.HeadingLevel="Level1" />

            <HorizontalStackLayout Spacing="12">
                <Button Text="Importar Excel"
                        HorizontalOptions="FillAndExpand"
                        Command="{Binding ImportExcelCommand}" />
                <Button Text="Ver preview"
                        HorizontalOptions="FillAndExpand"
                        Command="{Binding PreviewExcelCommand}"
                        BackgroundColor="{AppThemeBinding Light='#EEF2FF', Dark='#312E81'}"
                        TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
            </HorizontalStackLayout>

            <Border Background="{AppThemeBinding Light='#F4F4F5', Dark='#1F2937'}"
                    Padding="12"
                    StrokeThickness="0"
                    IsVisible="{Binding StatusMessage, Converter={StaticResource StringNotEmptyConverter}}">
                <Label Text="{Binding StatusMessage}"
                       TextColor="{AppThemeBinding Light='#6B7280', Dark='#D1D5DB'}" />
            </Border>
        </VerticalStackLayout>

        <Grid Grid.Row="1">
            <RefreshView Command="{Binding RefreshCommand}"
                         IsRefreshing="{Binding IsRefreshing}">
                <CollectionView ItemsSource="{Binding PriceLists}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedPriceList, Mode=TwoWay}"
                                Margin="0,12,0,0">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout Spacing="8"
                                             Padding="24"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             IsVisible="{Binding IsEmpty}">
                            <Label Text="ðŸ“‚" FontSize="36" HorizontalTextAlignment="Center" />
                            <Label Text="Importa tu primer Excel para comenzar."
                                   HorizontalTextAlignment="Center"
                                   Style="{StaticResource MutedLabel}" />
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PriceList">
                            <Border Style="{StaticResource CardBorderStyle}"
                                    Padding="16"
                                    Margin="0,8">
                                <Grid ColumnDefinitions="*,Auto"
                                      RowDefinitions="Auto,Auto,Auto"
                                      ColumnSpacing="12">
                                    <VerticalStackLayout Grid.RowSpan="3"
                                                         Grid.Column="0"
                                                         Spacing="6">
                                        <Label Text="{Binding Name}"
                                               FontAttributes="Bold"
                                               FontSize="18" />
                                        <Label Text="{Binding ImportedAtUtc, StringFormat='Importado {0:dd/MM/yyyy HH:mm}'}"
                                               Style="{StaticResource MutedLabel}" />
                                        <Label Text="{Binding SourceFileName}"
                                               Style="{StaticResource MutedLabel}"
                                               LineBreakMode="TailTruncation" />
                                    </VerticalStackLayout>

                                    <Label Grid.Column="1"
                                           Grid.RowSpan="3"
                                           Text="â€º"
                                           FontSize="26"
                                           TextColor="{AppThemeBinding Light='#9CA3AF', Dark='#9CA3AF'}"
                                           VerticalOptions="Center"
                                           HorizontalOptions="End" />
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               WidthRequest="48"
                               HeightRequest="48" />
        </Grid>
    </Grid>
</ContentPage>
