<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:PriceLists.Maui.ViewModels"
             xmlns:models="clr-namespace:PriceLists.Core.Models;assembly=PriceLists.Core"
             x:Class="PriceLists.Maui.Views.ListsPage"
             x:DataType="vm:ListsViewModel"
             Title="Listas de precios">

    <ContentPage.Resources>
        <Style x:Key="CardBorderStyle" TargetType="Border">
            <Setter Property="StrokeThickness" Value="1" />
            <Setter Property="Stroke" Value="{AppThemeBinding Light='#E5E7EB', Dark='#2F2F2F'}" />
            <Setter Property="Background" Value="{AppThemeBinding Light='#FFFFFF', Dark='#161616'}" />
            <Setter Property="Padding" Value="18" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="18" />
                </Setter.Value>
            </Setter>
            <Setter Property="Shadow">
                <Setter.Value>
                    <Shadow Radius="10" Opacity="0.12" Brush="{AppThemeBinding Light='#171717', Dark='#000000'}" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MutedLabel" TargetType="Label">
            <Setter Property="FontSize" Value="13" />
            <Setter Property="TextColor" Value="{AppThemeBinding Light='#6B7280', Dark='#9CA3AF'}" />
        </Style>

        <Style x:Key="BadgeBorderStyle" TargetType="Border">
            <Setter Property="StrokeThickness" Value="0" />
            <Setter Property="Background" Value="{AppThemeBinding Light='#EEF2FF', Dark='#1E1B4B'}" />
            <Setter Property="Padding" Value="10,6" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="14" />
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="StatusBorderStyle" TargetType="Border">
            <Setter Property="Background" Value="{AppThemeBinding Light='#F4F4F5', Dark='#1F2937'}" />
            <Setter Property="StrokeThickness" Value="0" />
            <Setter Property="Padding" Value="12" />
            <Setter Property="StrokeShape">
                <Setter.Value>
                    <RoundRectangle CornerRadius="12" />
                </Setter.Value>
            </Setter>
        </Style>
    </ContentPage.Resources>

    <Grid RowDefinitions="Auto,*" Padding="24">
        <VerticalStackLayout Spacing="14">
            <Label Text="Listas de precios"
                   FontAttributes="Bold"
                   FontSize="32"
                   SemanticProperties.HeadingLevel="Level1" />
            <Label Text="Importa, filtra y abre tus listas rÃ¡pidamente."
                   Style="{StaticResource MutedLabel}" />

            <HorizontalStackLayout Spacing="10">
                <Border Style="{StaticResource BadgeBorderStyle}">
                    <HorizontalStackLayout Spacing="6">
                        <Label Text="Listas"
                               FontAttributes="Bold"
                               FontSize="13"
                               TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
                        <Label Text="{Binding FilteredListsCount, StringFormat='{}{0} / '}"
                               FontAttributes="Bold"
                               FontSize="13"
                               TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
                        <Label Text="{Binding TotalListsCount, StringFormat='{}{0}'}"
                               FontAttributes="Bold"
                               FontSize="13"
                               TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
                    </HorizontalStackLayout>
                </Border>
            </HorizontalStackLayout>

            <SearchBar Placeholder="Buscar por nombre o archivo"
                       Text="{Binding SearchText}"
                       FontSize="16"
                       HeightRequest="52"
                       CancelButtonColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />

            <Grid ColumnDefinitions="*,*"
                  ColumnSpacing="12">
                <Button Text="Importar Excel"
                        Grid.Column="0"
                        HeightRequest="52"
                        FontAttributes="Bold"
                        FontSize="15"
                        CornerRadius="14"
                        Command="{Binding ImportExcelCommand}" />
                <Button Text="Ver preview"
                        Grid.Column="1"
                        HeightRequest="52"
                        FontAttributes="Bold"
                        FontSize="15"
                        CornerRadius="14"
                        Command="{Binding PreviewExcelCommand}"
                        BackgroundColor="{AppThemeBinding Light='#EEF2FF', Dark='#1E1B4B'}"
                        TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
            </Grid>

            <Border Style="{StaticResource StatusBorderStyle}"
                    IsVisible="{Binding StatusMessage, Converter={StaticResource StringNotEmptyConverter}}">
                <Label Text="{Binding StatusMessage}"
                       TextColor="{AppThemeBinding Light='#6B7280', Dark='#D1D5DB'}" />
            </Border>
        </VerticalStackLayout>

        <Grid Grid.Row="1">
            <RefreshView Command="{Binding RefreshCommand}"
                         IsRefreshing="{Binding IsRefreshing}">
                <CollectionView ItemsSource="{Binding PriceLists}"
                                SelectionMode="Single"
                                SelectedItem="{Binding SelectedPriceList, Mode=TwoWay}"
                                Margin="0,12,0,0">
                    <CollectionView.EmptyView>
                        <VerticalStackLayout Spacing="8"
                                             Padding="24"
                                             HorizontalOptions="Center"
                                             VerticalOptions="Center"
                                             IsVisible="{Binding IsEmpty}">
                            <Label Text="ðŸ“‚" FontSize="36" HorizontalTextAlignment="Center" />
                            <Label Text="Importa una lista o ajusta el filtro."
                                   HorizontalTextAlignment="Center"
                                   Style="{StaticResource MutedLabel}" />
                        </VerticalStackLayout>
                    </CollectionView.EmptyView>

                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="models:PriceListSummary">
                            <Border Style="{StaticResource CardBorderStyle}"
                                    Margin="0,10">
                                <Grid ColumnDefinitions="*,Auto"
                                      RowDefinitions="Auto,Auto,Auto"
                                      ColumnSpacing="12">
                                    <VerticalStackLayout Grid.RowSpan="3"
                                                         Grid.Column="0"
                                                         Spacing="6">
                                        <Label Text="{Binding Name}"
                                               FontAttributes="Bold"
                                               FontSize="20" />
                                        <Label Text="{Binding SourceFileName, TargetNullValue='Sin archivo asociado'}"
                                               Style="{StaticResource MutedLabel}"
                                               LineBreakMode="TailTruncation" />
                                        <Label Text="{Binding ImportedAtUtc, StringFormat='Importado {0:dd MMM yyyy HH:mm}'}"
                                               Style="{StaticResource MutedLabel}" />
                                    </VerticalStackLayout>

                                    <VerticalStackLayout Grid.Column="1"
                                                         Grid.RowSpan="3"
                                                         Spacing="8"
                                                         HorizontalOptions="End"
                                                         VerticalOptions="Center">
                                        <Border Style="{StaticResource BadgeBorderStyle}">
                                            <Label Text="{Binding ItemsCount, StringFormat='{}{0} productos'}"
                                                   FontAttributes="Bold"
                                                   FontSize="13"
                                                   TextColor="{AppThemeBinding Light='#4338CA', Dark='#C7D2FE'}" />
                                        </Border>
                                        <Label Text="â€º"
                                               FontSize="26"
                                               TextColor="{AppThemeBinding Light='#9CA3AF', Dark='#9CA3AF'}"
                                               HorizontalOptions="End" />
                                    </VerticalStackLayout>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>

            <ActivityIndicator IsRunning="{Binding IsBusy}"
                               IsVisible="{Binding IsBusy}"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               WidthRequest="48"
                               HeightRequest="48" />
        </Grid>
    </Grid>
</ContentPage>
